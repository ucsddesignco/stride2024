'use client';

import { useEffect, useState } from 'react';
import './Mascot.scss';
import { COLOR_THEMES } from '../constants';
import { MascotBreeds, MascotHats } from '../types';
import TestHat from './Hats/TestHat';

type MascotColors = {
  type?: string;
  head: string;
  arm: string;
  body: string;
};

const loadColorFromStorage = () => {
  const storedBreed = localStorage.getItem('mascot-color');

  return storedBreed
    ? COLOR_THEMES[storedBreed as MascotBreeds]
    : COLOR_THEMES.default;
};

const loadHatFromStorage = () => {
  const storedHat = localStorage.getItem('mascot-hat') as MascotHats;
  return storedHat || '';
};

export default function Mascot() {
  const [colors, setColors] = useState<MascotColors>(COLOR_THEMES.default);
  const [hat, setHat] = useState<MascotHats>('');
  const [isMounted, setIsMounted] = useState(false);

  const loadAllColors = () => {
    setColors(loadColorFromStorage());
  };

  const loadHat = () => {
    setHat(loadHatFromStorage());
  };

  useEffect(() => {
    loadAllColors();
    loadHat();
    setIsMounted(true);

    window.addEventListener('mascot-color', loadAllColors);
    window.addEventListener('mascot-hat', loadHat);

    return () => {
      window.removeEventListener('mascot-color', loadAllColors);
      window.removeEventListener('mascot-hat', loadHat);
    };
  }, []);

  return (
    <div className="mascot-container">
      <svg
        width="100%"
        height="100%"
        viewBox="0 0 322 556"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-label="Detective Ducky"
        style={{ opacity: isMounted ? 1 : 0 }}
        aria-hidden={!isMounted}
      >
        <path
          d="M266.852 87.6787C266.852 87.6787 266.886 87.6442 266.903 87.627Z"
          fill="#F3D31A"
        />
        <path
          d="M254.401 270.242C239.405 248.516 230.148 219.003 230.148 186.449C230.148 173.025 231.736 160.147 234.64 148.089C215.477 163.238 189.345 172.581 160.514 172.581C131.684 172.581 105.262 163.136 86.0646 147.85C88.9169 159.822 90.4882 172.632 90.4882 185.954C90.4882 220.284 80.2063 251.215 63.7416 273.213C60.7697 276.356 57.9857 279.652 55.3726 283.068C54.9797 283.461 54.6211 283.888 54.2282 284.281V284.588C39.6081 304.366 31 328.414 31 354.358C31 421.822 88.9852 476.511 160.497 476.511C232.01 476.511 289.995 421.822 289.995 354.358C289.995 321.771 276.434 292.172 254.384 270.276L254.401 270.242Z"
          fill={colors.body}
        />
        <path
          d="M303.741 549.499C303.741 549.499 237.967 543.762 237.967 516.11V453C222.389 463.881 204.115 471.502 184.255 474.914C199.816 477.154 202.17 481.517 202.46 483.333V521.848C202 531.387 198.963 549.635 182.259 549.516C180.45 549.516 179 550.976 179 552.758C179 554.54 180.467 556 182.259 556H303.741C305.55 556 307 554.54 307 552.758C307 550.976 305.533 549.516 303.741 549.516V549.499Z"
          fill="#F7941D"
        />
        <path
          d="M160.5 173C219.318 173 267 134.273 267 86.5C267 38.7274 219.318 0 160.5 0C101.682 0 54 38.7274 54 86.5C54 134.273 101.682 173 160.5 173Z"
          fill={colors.head}
        />
        <path
          d="M244.648 253.299C247.535 259.345 250.797 265.032 254.401 270.242C276.45 292.155 290.012 321.737 290.012 354.324C290.012 405.17 257.082 448.74 210.25 467.135C274.555 451.661 321.028 407.015 321.028 354.324C321.028 311.608 290.473 274.187 244.648 253.299Z"
          fill={colors.arm}
        />
        <path
          d="M31.0165 354.341C31.0165 328.397 39.6246 304.349 54.2448 284.571V284.264C54.6376 283.871 54.9963 283.444 55.3891 283.051C58.0023 279.635 60.7862 276.339 63.7581 273.196C68.1646 267.304 72.11 260.762 75.5601 253.691C30.1796 274.648 0 311.881 0 354.341C0 407.014 46.4735 451.677 110.778 467.151C63.946 448.757 31.0165 405.187 31.0165 354.341Z"
          fill={colors.arm}
        />
        <path
          d="M97.0368 86.0213C99.3211 80.3619 97.7054 74.3745 93.428 72.6481C89.1506 70.9216 83.8314 74.1099 81.5471 79.7694C79.2629 85.4288 80.8786 91.4161 85.156 93.1426C89.4334 94.869 94.7526 91.6807 97.0368 86.0213Z"
          fill="#3C2415"
        />
        <path
          d="M95.9172 79.4554C96.4785 78.0646 96.0827 76.5937 95.033 76.17C93.9834 75.7464 92.6774 76.5304 92.116 77.9212C91.5547 79.312 91.9505 80.7829 93.0002 81.2066C94.0498 81.6302 95.3558 80.8462 95.9172 79.4554Z"
          fill="white"
        />
        <path
          d="M236.457 93.182C240.735 91.4556 242.35 85.4682 240.066 79.8088C237.782 74.1494 232.463 70.9611 228.185 72.6875C223.908 74.4139 222.292 80.4013 224.576 86.0607C226.861 91.7201 232.18 94.9084 236.457 93.182Z"
          fill="#3C2415"
        />
        <path
          d="M236.244 81.2333C237.294 80.8096 237.689 79.3387 237.128 77.9479C236.567 76.5571 235.261 75.7731 234.211 76.1968C233.161 76.6204 232.766 78.0913 233.327 79.4821C233.888 80.8729 235.194 81.6569 236.244 81.2333Z"
          fill="white"
        />
        <path
          d="M219.301 126.223C198.084 119.118 189.911 106.231 187.732 101.975C182.981 90.8001 172.151 83 159.517 83C146.883 83 136.99 90.1727 131.949 100.601V100.567C131.949 100.567 125.309 117.761 99.461 126.325C89.7723 129.648 84 133.786 84 138.279C84 149.166 117.8 158 159.5 158C201.2 158 235 149.166 235 138.279C235 133.752 229.126 129.563 219.284 126.24L219.301 126.223Z"
          fill="#F7941D"
        />
        <path
          d="M138.741 549.532C122.037 549.651 119 531.4 118.54 521.859V483.338C118.813 481.539 121.167 477.158 136.745 474.917C116.885 471.505 98.611 463.865 83.0333 453V516.121C83.0333 543.777 17.2589 549.515 17.2589 549.515C15.4503 549.515 14 550.975 14 552.757C14 554.54 15.4673 556 17.2589 556H138.741C140.55 556 142 554.54 142 552.757C142 550.975 140.533 549.515 138.741 549.515V549.532Z"
          fill="#F7941D"
        />
        <g transform="translate(118, -50)" className="mascot-hat">
          {hat === 'test' && <TestHat mask />}
        </g>
      </svg>
    </div>
  );
}
